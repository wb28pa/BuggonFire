<!DOCTYPE html>
<html>
<head>
<title>Place Autocomplete</title>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no">
<meta charset="utf-8">
<link rel="stylesheet" href="transit_map_styless.css">

</head>
<body>

<input id="origin-input" class="controls" type="text"
placeholder="Enter an origin location">

<input id="destination-input" class="controls" type="text"
placeholder="Enter a destination location">

<div id="map"></div>
<div id="directions"><h3>Step by Step Directions</h3></div>

<script>

function initMap() {
var origin_place_id = null;
var destination_place_id = null;
var travel_mode = google.maps.TravelMode.TRANSIT;

var map = new google.maps.Map(document.getElementById('map'), {
mapTypeControl: false,
center: {lat:33.7678358,lng:-84.4906438},
zoom: 11
});
infoWindow = new gfireoogle.maps.InfoWindow;
        var marker = new google.maps.Marker;

	//geolocation service 	
	if (navigator.geolocation) {
		navigator.geolocation.getCurrentPosition(function(position) {
			var pos = {lat: position.coords.latitude,lng: position.coords.longitude};
			marker.setPosition(pos);
			marker.setVisible(true);                                
			marker.setMap(map);
			map.setMyLocationEnabled(true);
			infoWindow.setPosition(pos);
			infoWindow.setContent('Location found.');
			infoWindow.open(map);
			map.setCenter(pos);
			},
		 function(){handleLocationError(true, infoWindow, map.getCenter());});// get current location argument list
	}//navigator geolocation
	else {handleLocationError(false, infoWindow, map.getCenter());}   //if browser does not support this feature.
	


var trafficLayer = new google.maps.TrafficLayer();
        trafficLayer.setMap(map);
     
var directionsService = new google.maps.DirectionsService;
var directionsDisplay = new google.maps.DirectionsRenderer({
   polylineOptions: {
       strokeColor: '#429cf5',
       strokeWeight: 3.5,
       strokeOpacity: 0.8
   }
});
directionsDisplay.setMap(map);

directionsDisplay.setPanel(document.getElementById('directions'));

var origin_input = document.getElementById('origin-input');
var destination_input = document.getElementById('destination-input');
var modes = document.getElementById('mode-selector');

map.controls[google.maps.ControlPosition.TOP_LEFT].push(origin_input);
map.controls[google.maps.ControlPosition.TOP_LEFT].push(destination_input);
map.controls[google.maps.ControlPosition.TOP_LEFT].push(modes);

var origin_autocomplete = new google.maps.places.Autocomplete(origin_input);
origin_autocomplete.bindTo('bounds', map);
var destination_autocomplete =
new google.maps.places.Autocomplete(destination_input);
destination_autocomplete.bindTo('bounds', map);


function setupClickListener(id, mode) {
var radioButton = document.getElementById(id);
radioButton.addEventListener('click', function() {
travel_mode = 'BUS';
});
}

           
function expandViewportToFitPlace(map, place) {
if (place.geometry.viewport) {
map.fitBounds(place.geometry.viewport);
} else {
map.setCenter(place.geometry.location);
map.setZoom(17);
}
}

origin_autocomplete.addListener('place_changed', function() {
var place = origin_autocomplete.getPlace();
if (!place.geometry) {
window.alert("Autocomplete's returned place contains no geometry");
return;
}
expandViewportToFitPlace(map, place);

origin_place_id = place.place_id;
route(origin_place_id, destination_place_id, travel_mode,
directionsService, directionsDisplay);
});

destination_autocomplete.addListener('place_changed', function() {
var place = destination_autocomplete.getPlace();
if (!place.geometry) {
window.alert("Autocomplete's returned place contains no geometry");
return;
}
expandViewportToFitPlace(map, place);

destination_place_id = place.place_id;
route(origin_place_id, destination_place_id, travel_mode,
directionsService, directionsDisplay);
});

function route(origin_place_id, destination_place_id, travel_mode,
directionsService, directionsDisplay) {
if (!origin_place_id || !destination_place_id) {
return;
}
directionsService.route({
origin: {'placeId': origin_place_id},
destination: {'placeId': destination_place_id},
travelMode: 'TRANSIT',
transitOptions:{
modes: ['BUS'],
routingPreference: 'FEWER_TRANSFERS'
},
avoidHighways:false,
avoidTolls: false,
}, function(response, status) {
if (status === google.maps.DirectionsStatus.OK) {
directionsDisplay.setDirections(response);
} else {
window.alert('Directions request failed due to ' + status);
}
});
}
}


function handleLocationError(browserHasGeolocation, infoWindow, pos) {
        infoWindow.setPosition(pos);
        infoWindow.setContent(browserHasGeolocation ?
                              'Error: The Geolocation service failed.' :
                              'Error: Your browser doesn\'t support geolocation.');
        infoWindow.open(map);
}//error location handeler



</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAc_CmEQN0crstg_8G0HqIrWWNxUGQ5xjI&libraries=places&callback=initMap"
async defer></script>
</body>
</html>